-- Base de datos para proyecto de pizarra Kanban
CREATE DATABASE kanban_board;
USE kanban_board;

-- Tabla de usuarios
CREATE TABLE usuarios (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de proyectos/tableros
CREATE TABLE tableros (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(200) NOT NULL,
    descripcion TEXT,
    usuario_id INT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE
);

-- Tabla de columnas (To Do, In Progress, Done, etc.)
CREATE TABLE columnas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL,
    posicion INT NOT NULL,
    tablero_id INT,
    color VARCHAR(7) DEFAULT '#f0f0f0',
    FOREIGN KEY (tablero_id) REFERENCES tableros(id) ON DELETE CASCADE
);

-- Tabla de tarjetas/tareas
CREATE TABLE tarjetas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    titulo VARCHAR(200) NOT NULL,
    descripcion TEXT,
    columna_id INT,
    posicion INT NOT NULL,
    prioridad ENUM('baja', 'media', 'alta') DEFAULT 'media',
    fecha_vencimiento DATE,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_modificacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (columna_id) REFERENCES columnas(id) ON DELETE CASCADE
);

-- Tabla de etiquetas
CREATE TABLE etiquetas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    color VARCHAR(7) NOT NULL,
    tablero_id INT,
    FOREIGN KEY (tablero_id) REFERENCES tableros(id) ON DELETE CASCADE
);

-- Tabla de relación tarjetas-etiquetas
CREATE TABLE tarjeta_etiquetas (
    tarjeta_id INT,
    etiqueta_id INT,
    PRIMARY KEY (tarjeta_id, etiqueta_id),
    FOREIGN KEY (tarjeta_id) REFERENCES tarjetas(id) ON DELETE CASCADE,
    FOREIGN KEY (etiqueta_id) REFERENCES etiquetas(id) ON DELETE CASCADE
);

-- Insertar datos de ejemplo
INSERT INTO usuarios (nombre, email, password) VALUES 
('Admin', 'admin@kanban.com', '$2y$10$example_hash');

INSERT INTO tableros (nombre, descripcion, usuario_id) VALUES 
('Mi Proyecto', 'Tablero principal del proyecto', 1);

INSERT INTO columnas (nombre, posicion, tablero_id, color) VALUES 
('Por Hacer', 1, 1, '#ffeb3b'),
('En Progreso', 2, 1, '#2196f3'),
('Revisión', 3, 1, '#ff9800'),
('Completado', 4, 1, '#4caf50');